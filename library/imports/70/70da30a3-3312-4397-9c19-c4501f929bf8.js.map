{"version":3,"sources":["assets\\Script\\User.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\r\nimport {ethers} from 'ethers/dist/ethers.umd.min.js';\r\n\r\n@ccclass\r\nexport default class User extends cc.Component {\r\n\r\n\taddress: string = '';\r\n\tprivateKey: string = '';\r\n\trogueLandAddress: string = '0xb96Dcc78667C9E76b4459abE6771cC3172663471';\r\n\t//punkInfo: any = null;\r\n\t\r\n\t@property(cc.Label)\r\n    label: cc.Label = null;\r\n\t\r\n\t@property(cc.EditBox)\r\n    editbox: cc.EditBox = null;\r\n\t\r\n\t@property(cc.JsonAsset)\r\n    rogueLandJson: cc.JsonAsset = null;\r\n\t\r\n\t@property(cc.Node)\r\n    punk: cc.Node = null;\r\n\t\r\n\tstartGame (e, msg) {\r\n        cc.log(msg);\r\n\t\tcc.director.loadScene(\"game\");\r\n    },\r\n\t\r\n\tsetWallet (wallet) {\r\n\t\tconst walletData = {address: wallet.address, privateKey: wallet.privateKey}\r\n\t\tcc.sys.localStorage.setItem('wallet', JSON.stringify(walletData));\r\n\t\tthis.address = walletData.address\r\n\t\tthis.privateKey = walletData.privateKey\r\n    },\r\n\t\r\n\tshowAddress () {\r\n\t\tthis.editbox.string = this.address\r\n    },\r\n\t\r\n\tshowPrivateKey () {\r\n\t\tthis.editbox.string = this.privateKey\r\n    },\r\n\t\r\n\timportPrivateKey () {\r\n\t\ttry {\r\n\t\t\tconst wallet = new ethers.Wallet(this.editbox.string)\r\n\t\t    this.setWallet(wallet)\r\n\t\t\tthis.setUserInfo()\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tcc.log(err)\r\n\t\t}\r\n\t\t\r\n    },\r\n\t\r\n\tasync setUserInfo () {\r\n\t\tcc.sys.localStorage.removeItem('myPunk');\r\n\t\tconst provider = new ethers.providers.JsonRpcProvider(\"https://data-seed-prebsc-1-s2.binance.org:8545/\");\r\n\t\tconst rogueLandContract = new ethers.Contract(this.rogueLandAddress, this.rogueLandJson.json.abi, provider)\r\n        const punkId = await rogueLandContract.getAuthorizedId(this.address)\r\n\t\tif (punkId >= 0) {\r\n\t\t\tconst punkInfo = await rogueLandContract.getPunkInfo(this.address)\r\n\t\t\tthis.label.string = \"Welcome, \" + punkInfo.name\r\n\t\t\tlet remoteUrl = \"https://www.losernft.org\"+punkInfo.uri.slice(15)\r\n\t\t\tcc.sys.localStorage.setItem('myPunk', JSON.stringify({id: punkInfo.id, name: punkInfo.name, uri: remoteUrl}));\r\n\t\t\tlet sprite = this.node.getChildByName('punk_image').getComponent(cc.Sprite)\r\n\t\t\tcc.assetManager.loadRemote<cc.Texture2D>(remoteUrl, { ext: '.png', cacheEnabled: true }, function (err, pic) {\r\n              if (err) {\r\n                cc.log('LoadNetImg load error,error:' + err)\r\n                return\r\n              }\r\n              sprite.spriteFrame = new cc.SpriteFrame(pic)\r\n            });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcc.log(\"you are a visitor\")\r\n\t\t}\r\n\t\t\r\n    },\r\n\t\r\n\tonLoad () {\r\n\t\tlet walletData = JSON.parse(cc.sys.localStorage.getItem('wallet'));\r\n\t\tif (!walletData) {\r\n\t\t\tconst wallet = new ethers.Wallet.createRandom()\r\n\t\t\tthis.setWallet(wallet)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.address = walletData.address\r\n\t\t    this.privateKey = walletData.privateKey\r\n\t\t}\r\n\t\t\r\n\t\tthis.showAddress()\r\n\t\tthis.setUserInfo()\r\n    },\r\n\r\n    start () {\r\n\r\n    }\r\n}\r\n"]}