{"version":3,"sources":["assets\\Script\\User.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\r\nimport {ethers} from 'ethers/dist/ethers.umd.min.js';\r\n\r\n@ccclass\r\nexport default class User extends cc.Component {\r\n\r\n\taddress: string = '';\r\n\tprivateKey: string = '';\r\n\trogueLandAddress: string = '0x7066F9F9C8130405C32Ae1045AeFb4B45b11C30f';\r\n\t\r\n\t@property(cc.Label)\r\n    label: cc.Label = null;\r\n\t\r\n\t@property(cc.EditBox)\r\n    showAddressEditbox: cc.EditBox = null;\r\n\t\r\n\t@property(cc.EditBox)\r\n    showKeyEditbox: cc.EditBox = null;\r\n\t\r\n\t@property(cc.EditBox)\r\n    importKeyEditbox: cc.EditBox = null;\r\n\t\r\n\t@property(cc.JsonAsset)\r\n    rogueLandJson: cc.JsonAsset = null;\r\n\t\r\n\t@property(cc.Node)\r\n    punk: cc.Node = null;\r\n\t\r\n\tstartGame (e, msg) {\r\n        //cc.log(msg);\r\n\t\tcc.director.loadScene(\"game\");\r\n    },\r\n\t\r\n\tsetWallet (wallet) {\r\n\t\tconst walletData = {address: wallet.address, privateKey: wallet.privateKey}\r\n\t\tcc.sys.localStorage.setItem('wallet', JSON.stringify(walletData));\r\n\t\tthis.address = walletData.address\r\n\t\tthis.privateKey = walletData.privateKey\r\n    },\r\n\t\r\n\tset_zh () {\r\n\t\tcc.sys.localStorage.setItem('lang', 'zh');\r\n\t\tcc.director.loadScene(\"user\");\r\n    },\r\n\t\r\n\tset_en () {\r\n\t\tcc.sys.localStorage.setItem('lang', 'en');\r\n\t\tcc.director.loadScene(\"user\");\r\n    },\r\n\t\r\n\tnewAccount () {\r\n\t\tcc.sys.localStorage.removeItem('wallet')\r\n\t\tcc.director.loadScene(\"user\")\r\n    },\r\n\t\r\n\tshowAddress () {\r\n\t\tthis.showAddressEditbox.string = this.address\r\n    },\r\n\t\r\n\tshowPrivateKey () {\r\n\t\tthis.showKeyEditbox.string = this.privateKey\r\n    },\r\n\t\r\n\timportPrivateKey () {\r\n\t\ttry {\r\n\t\t\tconst wallet = new ethers.Wallet(this.importKeyEditbox.string)\r\n\t\t    this.setWallet(wallet)\r\n\t\t\tthis.setUserInfo()\r\n\t\t\tthis.showAddress()\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tcc.log(err)\r\n\t\t}\r\n\t\t\r\n    },\r\n\t\r\n\tasync setUserInfo () {\r\n\t\t\r\n\t\tconst provider = new ethers.providers.JsonRpcProvider(\"https://exchaintestrpc.okex.org\");\r\n\t\tconst rogueLandContract = new ethers.Contract(this.rogueLandAddress, this.rogueLandJson.json.abi, provider)\r\n        const punkInfo = await rogueLandContract.getPlayerInfo(this.address)\r\n\t\tif (punkInfo.id > 0) {\r\n\t\t\tthis.label.string = \"Welcome, \" + punkInfo.name\r\n\t\t\tlet remoteUrl = \"https://www.losernft.org\"+punkInfo.uri.slice(15)\r\n\t\t\tcc.sys.localStorage.setItem('myPunk', JSON.stringify({id: punkInfo.id.toString(), name: punkInfo.name, uri: remoteUrl}));\r\n\t\t\tlet sprite = this.node.getChildByName('punk_image').getComponent(cc.Sprite)\r\n\t\t\tcc.assetManager.loadRemote<cc.Texture2D>(remoteUrl, { ext: '.png', cacheEnabled: true }, function (err, pic) {\r\n              if (err) {\r\n                cc.log('LoadNetImg load error,error:' + err)\r\n                return\r\n              }\r\n              sprite.spriteFrame = new cc.SpriteFrame(pic)\r\n            });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcc.log(\"you are a visitor\")\r\n\t\t\tcc.sys.localStorage.setItem('myPunk', JSON.stringify({id: 0})\r\n\t\t}\r\n\t\t\r\n    },\r\n\t\r\n\tonLoad () {\r\n\t\t\r\n\t\tlet walletData = JSON.parse(cc.sys.localStorage.getItem('wallet'));\r\n\t\tif (!walletData) {\r\n\t\t\tconst wallet = new ethers.Wallet.createRandom()\r\n\t\t    this.setWallet(wallet)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.address = walletData.address\r\n\t\t    this.privateKey = walletData.privateKey\r\n\t\t}\r\n\t\t\r\n\t\tthis.showAddress()\r\n\t\tthis.setUserInfo()\r\n    },\r\n\r\n    start () {\r\n\r\n    }\r\n}\r\n"]}