{"version":3,"sources":["assets\\Script\\Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\r\nimport {ethers} from 'ethers/dist/ethers.umd.min.js';\r\n\r\nenum Status {Schedule, Committing, Committed, Confirmmed};\r\nenum Action {SitStill, GoLeft, GoRight, GoUp, GoDown, GoLeftUp, GoLeftDown, GoRightUp, GoRightDown};\r\n\r\n@ccclass\r\nexport default class Game extends cc.Component {\r\n\t\r\n\tid: number = 0;\r\n\tt: number = 0;\r\n\tcurrentSchedule: number = 0;\r\n\ttoCommit: number = 0;\r\n\tbalance: number = 0;\r\n\tmode: string = \"view\";\r\n\trogueLandAddress: string = '0x07de2043d322b48113dd04e7e2eec77232acf3e8';\r\n\trogueLandContract: any = null;\r\n\tprovider: any = null;\r\n\twallet: any = null;\r\n\tnumberList: any[] = [];\r\n\tpunks: any[] = [];\r\n\tchests: any[] = [];\r\n\t\r\n\t@property(cc.Label)\r\n    label: cc.Label = null;\r\n\t\r\n\t@property(cc.Button)\r\n    accountButton: cc.Button = null;\r\n\t\r\n\t@property(cc.Button)\r\n    modeButton: cc.Button = null;\r\n\t\r\n\t@property(cc.Button)\r\n    commitButton: cc.Button = null;\r\n\r\n    @property\r\n    text: string = 'hello';\r\n\t\r\n\t@property(cc.Prefab)\r\n    grassPrefab: cc.Prefab = null;\r\n\t\r\n\t@property(cc.Prefab)\r\n    chestPrefab: cc.Prefab = null;\r\n\t\r\n\t@property(cc.Prefab)\r\n    numberPrefab: cc.Prefab = null;\r\n\t\r\n\t@property(cc.Prefab)\r\n    punkPrefab: cc.Prefab = null;\r\n\t\r\n\t@property(cc.JsonAsset)\r\n    rogueLandJson: cc.JsonAsset = null;\r\n\t\r\n\t@property(cc.JsonAsset)\r\n    loserpunkJson: cc.JsonAsset = null;\r\n\t\r\n\t// Player 节点，用于获取主角的位置\r\n\t@property(cc.Node)\r\n    player: cc.Node = null;\r\n\t\r\n\t// Camera 节点，用于获取摄像头的位置\r\n\t@property(cc.Node)\r\n    camera: cc.Node = null;\r\n\t\r\n\tspawnNewGrass (x, y, action) {\r\n        // 使用给定的模板在场景中生成一个新节点\r\n        var newGrass = cc.instantiate(this.grassPrefab);\r\n        // 将新增的节点添加到 Canvas 节点下面\r\n        this.node.addChild(newGrass);\r\n        // 设置草地的位置\r\n        newGrass.setPosition(cc.v2(x,y));\r\n\t\t// 在草地脚本组件上保存 Camera 对象的引用\r\n        newGrass.getComponent('Grass').camera = this.camera;\r\n    },\r\n\t\r\n\tspawnNewChest (x, y) {\r\n        // 使用给定的模板在场景中生成一个新节点\r\n        var newChest = cc.instantiate(this.chestPrefab);\r\n        // 将新增的节点添加到 Canvas 节点下面\r\n        this.node.addChild(newChest);\r\n\t\tnewChest.zIndex = 2;\r\n        // 设置宝箱的位置\r\n        newChest.setPosition(cc.v2(x,y));\r\n\t\t\r\n\t\tthis.chests.push(newChest)\r\n    },\r\n\t\r\n\tspawnNewPunk (x, y, id) {\r\n        cc.log(x, y, id.toString())\r\n\t\t// 使用给定的模板在场景中生成一个新节点\r\n        var newPunk = cc.instantiate(this.punkPrefab);\r\n        // 将新增的节点添加到 Canvas 节点下面\r\n        this.node.addChild(newPunk);\r\n\t\tnewPunk.zIndex = 2;\r\n        // 设置punk的位置\r\n        newPunk.setPosition(cc.v2(x,y));\r\n\t\tthis.punks.push(newPunk)\r\n\t\t\r\n\t\tif (id > 0) {\r\n\t\t\t//console.log(this.loserpunkJson.json[id-1])\r\n\t\t\tlet remoteUrl = \"https://www.losernft.org/ipfs/\"+this.loserpunkJson.json[id-1].hash\r\n\t\t\tlet sprite = newPunk.getComponent(cc.Sprite)\r\n\t\t\tcc.assetManager.loadRemote<cc.Texture2D>(remoteUrl, { ext: '.png', cacheEnabled: true }, function (err, pic) {\r\n              if (err) {\r\n                cc.log('LoadNetImg load error,error:' + err)\r\n                return\r\n              }\r\n              sprite.spriteFrame = new cc.SpriteFrame(pic)\r\n            });\r\n\t\t}\r\n    },\r\n\t\r\n\tspawnNewNumber (x, y, action) {\r\n        // 使用给定的模板在场景中生成一个新节点\r\n        var newNumber = cc.instantiate(this.numberPrefab)\r\n        // 将新增的节点添加到 Canvas 节点下面\r\n        this.node.addChild(newNumber)\r\n\t\tnewNumber.zIndex = 2\r\n        // 设置数字的位置\r\n        newNumber.setPosition(cc.v2(x,y))\r\n\t\tlet color = new cc.Color(242,129,27)\r\n\t\tnewNumber.color = color\r\n\t\t// 增加1回合\r\n\t\tthis.t ++\r\n\t\tnewNumber.getComponent(cc.Label).string = this.t\r\n\t\tthis.numberList[this.t-this.currentSchedule-1] = {time: this.t, action: action, status: Status.Schedule, number: newNumber}\r\n\t\t// 更新地图\r\n\t\tthis.updateMap()\r\n    },\r\n\t\r\n\tsetLabel (t, x, y) {\r\n\t\tif (this.mode == 'view') {\r\n\t\t\tthis.text = `View Mode  T${t} (${x}, ${y})`\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.text = `${this.balance/1e18}BNB  T${t} (${x}, ${y})`\r\n\t\t}\r\n\t\tthis.label.string = this.text;\r\n\t}\r\n\t\r\n\tasync commit () {\r\n        let action = this.numberList[this.toCommit-this.currentSchedule]\r\n\t\taction.status = Status.Committing\r\n\t\tconst rogueLandSigner = this.rogueLandContract.connect(this.wallet)\r\n\t\tconst tx = await rogueLandSigner.scheduleAction(this.id, action.action)\r\n\t\taction.status = Status.Committed\r\n\t\taction.number.destroy()\r\n\t\tthis.toCommit ++;\r\n\t\tthis.balance = this.balance - tx.gasPrice*tx.gasLimit\r\n\t\tcc.log(tx.gasPrice/1e9*tx.gasLimit)\r\n    },\r\n\t\r\n\tasync loadPunk () {\r\n        let myPunk = JSON.parse(cc.sys.localStorage.getItem('myPunk'))\r\n\t\tif (myPunk) {\r\n\t\t  this.id = myPunk.id\r\n\t\t  let sprite = this.node.getChildByName('Player').getComponent(cc.Sprite)\r\n\t      cc.assetManager.loadRemote<cc.Texture2D>(myPunk.uri, { ext: '.png', cacheEnabled: true }, function (err, pic) {\r\n            if (err) {\r\n              cc.log('LoadNetImg load error,error:' + err)\r\n              return\r\n            }\r\n            sprite.spriteFrame = new cc.SpriteFrame(pic)\r\n          });\r\n\t\t}\r\n    },\r\n\t\r\n\tasync getStatus () {\r\n\t\tlet walletData = JSON.parse(cc.sys.localStorage.getItem('wallet'))\r\n\t\tconst walletPrivateKey = new ethers.Wallet(walletData.privateKey)\r\n\t\tthis.provider = new ethers.providers.JsonRpcProvider(\"https://data-seed-prebsc-1-s2.binance.org:8545/\")\r\n\t\tthis.wallet = walletPrivateKey.connect(this.provider)\r\n\t\tthis.rogueLandContract = new ethers.Contract(this.rogueLandAddress, this.rogueLandJson.json.abi, this.provider)\r\n\t\tif (this.id > 0) {\r\n\t\t\tthis.goViewMode()\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst currentTime = await this.rogueLandContract.getCurrentTime()\r\n\t\t\tthis.t = currentTime\r\n\t\t    //this.setLabel(this.t, 0, 0)\r\n\t\t}\r\n    },\r\n\t\r\n\tloadAccount (e, msg) {\r\n\t\tcc.director.loadScene(\"user\");\r\n    },\r\n\t\r\n\tasync updateMap () {\r\n\t\tlet x1 = this.player.x/64 - 7\r\n\t\tlet x2 = this.player.x/64 + 7\r\n\t\tlet y1 = this.player.y/64 - 5\r\n\t\tlet y2 = this.player.y/64 + 5\r\n\t\tconst map = await this.rogueLandContract.getEvents(x1, y1, x2, y2, this.t)\r\n\t\twhile (this.punks.length > 0) {\r\n\t\t\tlet node = this.punks.pop()\r\n\t\t\tnode.destroy();\r\n\t\t}\r\n\t\twhile (this.chests.length > 0) {\r\n\t\t\tlet node = this.chests.pop()\r\n\t\t\tnode.destroy();\r\n\t\t}\r\n\t\tlet i = 0\r\n        for (let x=x1; x<=x2; x++) {\r\n          for (let y=y1; y<=y2; y++) {\r\n            if (map[i].movingPunk != 0 && !(this.mode == \"schedule\" && map[i].movingPunk == this.id)) {\r\n\t\t\t  //cc.log(map[i].movingPunk, x, y)\r\n\t\t\t  this.spawnNewPunk (x*64, y*64, map[i].movingPunk)\r\n            }\r\n\t\t\tif (map[i].monster > 0) {\r\n\t\t\t  //cc.log(map[i].monster/1e18, x, y)\r\n\t\t\t  this.spawnNewChest (x*64, y*64)\r\n            }\r\n            i ++;\r\n          }\r\n        }\r\n\t\t//cc.log(this.punks)\r\n\t}\r\n\t\r\n\tasync goViewMode() {\r\n\t\tconst statusInfo = await this.rogueLandContract.getCurrentStatus(this.id)\r\n\t\tthis.mode = \"view\"\r\n\t\tthis.t = statusInfo.t\r\n\t\tthis.player.zIndex = 0\r\n\t\tthis.player.x = statusInfo.x * 64\r\n\t\tthis.player.y = statusInfo.y * 64\r\n\t\tthis.updateMap()\r\n\t}\r\n\t\r\n\tasync goScheduleMode() {\r\n\t\tconst statusInfo = await this.rogueLandContract.getScheduleInfo(this.id)\r\n\t\tthis.mode = \"schedule\"\r\n\t\tthis.t = statusInfo.t\r\n\t\tthis.player.zIndex = 3\r\n\t\tthis.currentSchedule = statusInfo.t\r\n\t\tthis.toCommit = statusInfo.t\r\n\t\tthis.player.x = statusInfo.x * 64\r\n\t\tthis.player.y = statusInfo.y * 64\r\n\t\tthis.updateMap()\r\n\t\tthis.balance = await this.wallet.getBalance();\r\n\t}\r\n\t\r\n\tswitchMode (e, msg) {\r\n        if (this.mode == \"view\") {\r\n\t\t\tthis.goScheduleMode()\r\n\t\t}\r\n\t\telse if (this.mode == \"schedule\") {\r\n\t\t\tthis.goViewMode()\r\n\t\t}\r\n    },\r\n\t\r\n\t\r\n    update(dt) {\r\n\t\tif (Math.abs(this.player.x) < 9*64) {\r\n\t\t\tthis.camera.x = this.player.x\r\n\t\t}\r\n\t\tif (Math.abs(this.player.y) < 12*64) {\r\n\t\t\tthis.camera.y = this.player.y\r\n\t\t}\r\n\t\tthis.setLabel(this.t, this.player.x/64, this.player.y/64)\r\n\t}\r\n\t\r\n\tonKeyDown (event) {\r\n\t\t// set a flag when key pressed\r\n        \r\n\t\tswitch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n\t\t\tcase cc.macro.KEY.left:\r\n\t\t\t    if (this.mode == \"schedule\") {\r\n\t\t\t      this.spawnNewNumber(this.player.x, this.player.y, Action.GoLeft)\r\n\t\t        }\r\n\t\t\t\tthis.player.getComponent('Player').moveLeft()\r\n                break;\r\n            case cc.macro.KEY.d:\r\n\t\t\tcase cc.macro.KEY.right:\r\n\t\t\t    if (this.mode == \"schedule\") {\r\n\t\t\t      this.spawnNewNumber(this.player.x, this.player.y, Action.GoRight)\r\n\t\t        }\r\n                this.player.getComponent('Player').moveRight()\r\n                break;\r\n\t\t    case cc.macro.KEY.s:\r\n\t\t\tcase cc.macro.KEY.down:\r\n                if (this.mode == \"schedule\") {\r\n\t\t\t      this.spawnNewNumber(this.player.x, this.player.y, Action.GoDown)\r\n\t\t        }\r\n\t\t\t\tthis.player.getComponent('Player').moveDown()\r\n                break;\r\n            case cc.macro.KEY.w:\r\n\t\t\tcase cc.macro.KEY.up:\r\n                if (this.mode == \"schedule\") {\r\n\t\t\t      this.spawnNewNumber(this.player.x, this.player.y, Action.GoUp)\r\n\t\t        }\r\n\t\t\t\tthis.player.getComponent('Player').moveUp()\r\n                break;\r\n\t\t\tcase cc.macro.KEY['+']:\r\n                if (this.mode == \"view\") {\r\n\t\t\t\t\tthis.t ++\r\n\t\t\t\t\tthis.updateMap()\r\n\t\t\t\t}\r\n                break;\r\n            case cc.macro.KEY['-']:\r\n                if (this.mode == \"view\" && this.t > 0) {\r\n\t\t\t\t\tthis.t --\r\n\t\t\t\t\tthis.updateMap()\r\n\t\t\t\t}\r\n                break;\r\n\t\t\tcase cc.macro.KEY['.']:\r\n                if (this.mode == \"view\") {\r\n\t\t\t\t\tthis.updateMap()\r\n\t\t\t\t}\r\n                break;\r\n        }\r\n    },\r\n\t\r\n\tonLoad () {\r\n\t\tthis.label.node.zIndex = 2;\r\n\t\tthis.accountButton.node.zIndex = 2;\r\n\t\tthis.modeButton.node.zIndex = 2;\r\n\t\tthis.commitButton.node.zIndex = 2;\r\n\t\t// 生成草地\r\n        let windowSize=cc.view.getVisibleSize();\r\n        cc.log(\"width=\"+windowSize.width+\",height=\"+windowSize.height);\r\n\t\tfor (let i=-7; i<=7; i++) {\r\n\t\t\tfor (let j=-5; j<=5; j++) {\r\n\t\t\t\tthis.spawnNewGrass(i*64, j*64);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 初始化键盘输入监听\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    },\r\n\r\n    start () {\r\n        // init logic\r\n        this.label.string = this.text\r\n\t\tthis.loadPunk()\r\n\t\tthis.getStatus()\r\n    }\r\n}\r\n"]}